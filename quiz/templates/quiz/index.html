{% extends 'login/base.html' %}
{% load static %}

{% block head %}
<link rel="stylesheet" type="text/css" href="{% static 'quiz/css/jquery.countdownTimer.css' %}"/>
<script type="text/javascript" src="{% static 'quiz/js/jquery.countdownTimer.min.js'  %}"></script>

<link rel="stylesheet" href="{% static 'quiz/css/prism.css' %}">

<script type="text/javascript" src="{% static 'quiz/js/prism.js' %}"></script>


<link rel="stylesheet" href="{% static 'quiz/css/index.css' %}">
<script type="text/javascript" src="{% static 'quiz/js/index.js' %}"></script>

<script type="text/javascript">

$(function(){
$('#ms_timer').countdowntimer({
minutes : {{user.rmin}},
seconds : {{user.rsec}},
size : "lg",
expiryUrl : "/",
});
});

var csrfcookie = function() {
var cookieValue = null,
    name = 'csrftoken';
if (document.cookie && document.cookie !== '') {
    var cookies = document.cookie.split(';');
    for (var i = 0; i < cookies.length; i++) {
        var cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) == (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
        }
    }
}
return cookieValue;
};

var params = function () {
        timer()
        var ps = "min=" + document.getElementById('minrem').value+"&sec="+document.getElementById('secrem').value;
        console.log(ps);
        return ps;
    }


setInterval(function(){ 
    
var data_file = "../../timer";
  var http_request = new XMLHttpRequest();

  http_request.open("POST", data_file, true);


  http_request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
  http_request.setRequestHeader('X-CSRFToken', csrfcookie());

  http_request.send(params());

}, 5000);

</script>



{% endblock %}

{%block content%}

<div class="container">
        
<div id="box" class="row">

<div id="logo" class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
 <div id="end" class = "col-lg-2 col-lg-push-10 btn btn-info">
  <h5>End Test</h5>
  </div>

</div>

<div class="row">
<div class = "countdowntimer col-lg-5">
<span id="ms_timer"></span>
</div>




{% for x  in status %}
{% if x.question.id == question.id %}
{# click div #}
<div id="dstat" onclick="curStat()" class="col-lg-2 col-lg-push-5 status-btn {{x.Qstatus}}">
</div>
{% endif %}
{% endfor %}

<div class="col-lg-10 col-md-10 col-sm-10 col-xs-12">

<div class="panel panel-info">

<div class="panel panel-heading">
{% for x in status %}
{% if x.question.id == question.id %}
<h1 class="panel-title"> 
Question {{forloop.counter}}
{% endif %}
{% endfor %}
</h1>
</div>
{# display question #}
<div class="panel-body">
<h1>{{question.question_text}}
</h1>
{% if question.code %}
<pre>
<code class="language-clike">
{{question.code}}
</code>
</pre>
{% endif %}
</div>
</div>


<form action="{% url 'quiz:disp' question.id %}" method="post" onsubmit="timer()">
    {% csrf_token %}
    {% for choice in question.choice_set.all %}
    {% if current_status.selected == choice.id %}
    <input type="radio" onclick="hi()" name="choice" value="{{choice.id}}" checked = "checked"/>
    {% else %}
    <input type="radio" onclick="hi()" name="choice" value="{{choice.id}}" />
    {% endif %}
    <label>{{choice.choice_text}}</label> <br>
    {% endfor %}
    
   <div class="nav col-lg-12">
    {%if question.id != first_question.id %}
    <input type= "submit"  class = "btn btn-primary" value = "Previous" name = "nav">
    {% endif %}
    {% if question.id != last_question.id %}
    <input type="submit" class = "btn btn-primary"  value="Next" name = "nav">
    {% else %}
    <input type="submit" name = "nav" class="btn btn-primary" value="Finish" >  
    {% endif %}
   </div>
   {# hidden inp  #}
   {% for x in status %}
   {% if x.question.id == question.id %}
   <input type ="hidden" id="status" name="status" value={{x.Qstatus}}>
   {% endif %}
   {% endfor %}

<input type ="hidden" id="minrem" name="min" value={{user.rmin}}>
   <input type ="hidden" id="secrem" name="sec" value={{user.rsec}}>

</div>

<div id="rightbox" class="col-lg-1">
{% for x in status %}
<input id="side" value ="{{forloop.counter}}" type ="submit" class="btn  hidden-xs {{x.Qstatus}}" name = "nav">
{% endfor %}
</div>

</form>

</div>
</div>
</div>
{% endblock %}